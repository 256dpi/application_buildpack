# ---------------------------------------------------------------
# Monit configuration file generated by application_buildpack for:
# <%= group = "#{@name}-#{@type}" %>
# ---------------------------------------------------------------

<% @number.times do |i| %>
check process <%= "#{group}-#{i}" %> with pidfile <%= pid_file = "#{@pid_prefix}-#{i}.pid" %>
  depends on <%= "#{group}" %>.restart
  depends on <%= "#{group}" %>.reload
  start program = "/bin/bash -c 'env PID_FILE=<%= pid_file %> PROCESS_NUM=<%= i %> /etc/init.d/<%= "#{group}" %> start'" with timeout 60 seconds
  stop program  = "/bin/bash -c 'env PID_FILE=<%= pid_file %> /etc/init.d/<%= "#{group}" %> stop'" with timeout 60 seconds
  group <%= "#{group}" %>
<% end %>

check file <%= "#{group}" %>.restart with path <%= @lock_path %>/<%= @type %>.restart
  if changed timestamp then restart

check file <%= "#{group}" %>.reload with path <%= @lock_path %>/<%= @type %>.reload
<% if @options && @options.has_key?(:reload) %>
  if changed timestamp then exec "/bin/bash -c 'kill -s <%= @options[:reload] %> $(cat <%= @pid_prefix %>-*.pid)'"
<% else %>
  if changed timestamp then restart
<% end %>
